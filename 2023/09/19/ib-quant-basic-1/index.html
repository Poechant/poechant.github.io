<!DOCTYPE html>
<html>

<head>
	<!-- Meta -->
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="generator" content="Jekyll">

	<title>趋势量化基础（持续更新）</title>
  	<meta name="description" content="麦克船长对于技术、产品、商业等领域的分享|AI,A.I.,NLP,神经网络,人工智能,自然语言处理,BERT,GPT,ChatGPT,OpenAI,阿里巴巴,P9,运营,淘宝,天猫,总监,高管">

	<!-- CSS & fonts -->
	<link rel="stylesheet" href="/css/main.css">

	<!-- RSS -->
	<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

  	<!-- Favicon -->
 	 <link rel="shortcut icon" type="image/png" href="/img/favicon.png">

 	 <!-- Syntax highlighter -->
  	<link rel="stylesheet" href="/css/syntax.css" />

  	<!--KaTeX-->
  	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
  	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
  	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
  	<script>
  		document.addEventListener("DOMContentLoaded", function() {
  			renderMathInElement(document.body, {
  				// ...options...
  			});
  		});
  	</script>

  	
  	<!-- KaTeX -->
  	<link rel="stylesheet" href="/assets/plugins/katex.0.11.1/katex.min.css">
  	

  	
  		<script async src="https://www.googletagmanager.com/gtag/js?id=G-CH4708X4R5"></script>
  		<script>
    		window.dataLayer = window.dataLayer || [];
    		function gtag(){dataLayer.push(arguments);}
    		gtag('js', new Date());

    		gtag('config', 'G-CH4708X4R5');
  		</script>
	


</head>

<body>
	<div id="wrap">
	  	
	  	<!-- Navigation -->
	  	<nav id="nav">
	<div id="nav-list">
		<a href="/">Home</a>

		<!-- Nav pages -->
	  <!-- 
	    
	  
	    
	      <a href="/about/" title="关于我">关于我</a>
	    
	  
	    
	  
	    
	  
	    
	      <a href="/booklist/" title="读书行路">读书行路</a>
	    
	  
	    
	  
	    
	      <a href="/categories/" title="Categories">Categories</a>
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	   -->

	  <!-- Tech category pages -->






  <a href="/category/ai" title="AI">AI</a>

















  <a href="/category/rt_tech" title="RT">RT</a>





  <a href="/category/web" title="前端">前端</a>
















<!-- Non-tech category pages -->












  <a href="/category/design" title="设计">设计</a>









  <a href="/category/quant" title="投资">投资</a>





  <a href="/category/thinking" title="思考">思考</a>

















	  
        
      
        
          <a href="/about/" title="关于我">关于我</a>
        
      
        
      
        
      
        
          <a href="/booklist/" title="读书行路">读书行路</a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    <!-- Nav links -->
	  <!-- <a href="https://github.com/thereviewindex/monochrome/archive/master.zip">Download</a>
<a href="https://github.com/thereviewindex/monochrome">Project on Github</a> -->

	</div>
  
  <!-- Nav footer -->
	
	  <footer>
	
	<span>version 1.0.0</span>

</footer>
	

</nav>

    
    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>

      <!-- Header -->
      
        <header id="header" class="parent justify-spaceBetween">
  <div class="inner w100 relative">
    <span class="f-left">  
      <a href="/">
        <h1>
          <span>Mike</span>Captain
        </h1>
      </a>
    </span>
    <span id="nav-links" class="absolute right bottom">

      <!-- Tech category pages -->






  <a href="/category/ai" title="AI">AI</a>

















  <a href="/category/rt_tech" title="RT">RT</a>





  <a href="/category/web" title="前端">前端</a>
















<!-- Non-tech category pages -->












  <a href="/category/design" title="设计">设计</a>









  <a href="/category/quant" title="投资">投资</a>





  <a href="/category/thinking" title="思考">思考</a>

















      &nbsp;&nbsp;&nbsp;丨&nbsp;

      <!-- Nav pages -->
      
        
      
        
          <a href="/about/" title="关于我">关于我</a>
        
      
        
      
        
      
        
          <a href="/booklist/" title="读书行路">读书行路</a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      
      <!-- Nav links -->
      <!-- <a href="https://github.com/thereviewindex/monochrome/archive/master.zip">Download</a>
<a href="https://github.com/thereviewindex/monochrome">Project on Github</a> -->

    </span>
  </div>
</header>




      

    <!-- Main content -->
	  <div id="container">

		<main>

			<article id="post-page">
	<h2>趋势量化基础（持续更新）</h2>		
	<time datetime="2023-09-19T08:00:13+08:00" class="by-line">19 Sep 2023, 杭州 | 麦克船长 | 总计 2775 字</time>
	<div class="content">
		<h4 id="get-historical-data-of-specific-option">Get historical data of specific option</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">ib_insync</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">pytz</span>

<span class="c1"># 连接到IB TWS或Gateway
</span><span class="n">util</span><span class="p">.</span><span class="n">startLoop</span><span class="p">()</span>
<span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
<span class="n">ib</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="mi">7496</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 请根据你的设置进行连接
</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Option</span><span class="p">(</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s">'QQQ'</span><span class="p">,</span> <span class="n">lastTradeDateOrContractMonth</span><span class="o">=</span><span class="s">'20231004'</span><span class="p">,</span>
    <span class="n">strike</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="s">'C'</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="s">'CBOE'</span><span class="p">,</span>
    <span class="n">multiplier</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s">'USD'</span><span class="p">)</span>

<span class="c1"># 使用 pytz 库来定义美国东部时区
</span><span class="n">est</span> <span class="o">=</span> <span class="n">pytz</span><span class="p">.</span><span class="n">timezone</span><span class="p">(</span><span class="s">'America/New_York'</span><span class="p">)</span>

<span class="c1"># 将结束日期时间转换为美国东部时区
</span><span class="n">endDateTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">est</span><span class="p">)</span>

<span class="n">bars</span> <span class="o">=</span> <span class="n">ib</span><span class="p">.</span><span class="n">reqHistoricalData</span><span class="p">(</span>
            <span class="n">contract</span><span class="o">=</span><span class="n">contract</span><span class="p">,</span> <span class="n">endDateTime</span><span class="o">=</span><span class="n">endDateTime</span><span class="p">,</span> <span class="n">durationStr</span><span class="o">=</span><span class="s">'1 D'</span><span class="p">,</span> <span class="n">barSizeSetting</span><span class="o">=</span><span class="s">'1 min'</span><span class="p">,</span>
            <span class="n">whatToShow</span><span class="o">=</span><span class="s">'TRADES'</span><span class="p">,</span> <span class="n">useRTH</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># 将数据转换为DataFrame格式
</span><span class="n">df</span> <span class="o">=</span> <span class="n">util</span><span class="p">.</span><span class="n">df</span><span class="p">(</span><span class="n">bars</span><span class="p">)</span>

<span class="c1"># 打印DataFrame，每分钟数据一行
</span><span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">pytz</code> library is a Python library for handling timezones, and it also utilizes the <code class="language-plaintext highlighter-rouge">util</code> module from the <code class="language-plaintext highlighter-rouge">pandas</code> library. The loop begins with <code class="language-plaintext highlighter-rouge">util.startLoop()</code>, establishing a continuous loop. Then, an IB (Interactive Brokers) connection is created. Following this, an Option contract is instantiated, using QQQ as an example, with an expiration date of 2023-10-04, a target price of 360, and a Call option on the CBOE exchange, denominated in US dollars.</p>

<p>Next, a variable <code class="language-plaintext highlighter-rouge">est</code> is created to represent the Eastern Standard Time (EST) timezone. Another variable is set for the desired end time of the data retrieval, which, in this case, is the closing time on 2023-09-29 at 4:00 PM. The timezone information is specified using <code class="language-plaintext highlighter-rouge">tzinfo=est</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">ib.reqHistoricalData</code> function is then used to retrieve the data with a duration of one day (<code class="language-plaintext highlighter-rouge">durationStr='1 D'</code>) and a time interval of one minute (<code class="language-plaintext highlighter-rouge">barSizeSetting='1 min'</code>). Finally, the obtained data is printed using <code class="language-plaintext highlighter-rouge">util.df(bars)</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>vnpy<span class="o">)</span> mikecaptain@CVN testspace % python ib_get_option_data_3.py
                         <span class="nb">date  </span>open  high   low  close  volume  average  barCount
0   2023-09-29 08:47:00-05:00  4.13  4.13  4.13   4.13     1.0     4.13         1
1   2023-09-29 08:48:00-05:00  4.13  4.13  4.13   4.13     0.0     4.13         0
2   2023-09-29 08:49:00-05:00  4.13  4.13  4.13   4.13     0.0     4.13         0
3   2023-09-29 08:50:00-05:00  4.13  4.13  4.13   4.13     0.0     4.13         0
4   2023-09-29 08:51:00-05:00  4.13  4.13  4.13   4.13     0.0     4.13         0
..                        ...   ...   ...   ...    ...     ...      ...       ...
383 2023-09-29 15:10:00-05:00  2.49  2.49  2.49   2.49     0.0     2.49         0
384 2023-09-29 15:11:00-05:00  2.49  2.49  2.49   2.49     0.0     2.49         0
385 2023-09-29 15:12:00-05:00  2.49  2.49  2.49   2.49     0.0     2.49         0
386 2023-09-29 15:13:00-05:00  2.49  2.49  2.49   2.49     0.0     2.49         0
387 2023-09-29 15:14:00-05:00  2.49  2.49  2.49   2.49     0.0     2.49         0

<span class="o">[</span>388 rows x 8 columns]
</code></pre></div></div>

	</div>
</article>



	  </main>
		
		  <!-- Pagination links -->
      

	  </div>
	    
	    <!-- Footer -->
	    <footer>
	<span>
		-<br/><br/>
		船长还不会游泳 at 微信公众号/微博<br/>
		@麦克船长 at 即刻/知乎/小宇宙/掘金/小红书/微信读书<br/>
		@船长模玩 at Bilibili<br/>
		Copyright © 2011-2023, MikeCaptain.com
	</span>
</footer>


	    <!-- Script -->
      <script src="/js/main.js"></script>	


	</div>
</body>
</html>
